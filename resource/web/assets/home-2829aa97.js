import{u as te,p as P,a as le}from"./user-86fc3259.js";/* empty css                        *//* empty css                    *//* empty css                     *//* empty css                     *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  */import{d as oe,a as N,r as m,P as ae,j as _,Q as se,R as pe,b as re,S as ne,T as de,E as ue,e as ie,U as ce,f as me,c as _e,V as fe,W as he,X as be,g as U,h as r,i as e,w as t,L as R,A as f,m as h,o as n,I as B,J as q,p as ge,Y as Ie,B as j,z,q as ve,s as Fe,u as je,t as T,_ as ye}from"./index-83698f75.js";const V=b=>(ve("data-v-db33bb1d"),b=b(),Fe(),b),we={class:"main-wrap home-wrap"},Le=V(()=>r("div",{class:"wrap-title"},[r("p",null,"文件上传")],-1)),Pe={class:"upload-form flex-space"},Ue={class:"left-form w50"},Ve=V(()=>r("div",{class:"el-upload__text"},[j(" Drop file here or "),r("em",null,"click to upload")],-1)),Ee={class:"right-upload-info w50"},Se={class:"line-head flex-space"},ke=V(()=>r("p",null,[j(" 历史记录 "),r("span",null,"top 10")],-1)),xe={class:"rl-btn"},Ce=oe({__name:"home",setup(b){let E=N({table:[]});const H=je();let g=m(!1);const I=te(),S=m();let y=m(!1),w=m(!1);const l=N({uploadForm:{file:"",projectId:void 0,pathId:void 0,subPath:"",otherInfo:""},uploadFormRules:{projectId:[{required:!0,trigger:"blur",message:"请选择项目!"}],pathId:[{required:!0,trigger:"blur",message:"请选择文件上传路径！"}]},projectList:[],projectPathList:[]});let i=m([]);ae(()=>{J(),v()});const M=s=>(s.file&&(l.uploadForm.file=s.file),s.file);function A(){var s;(s=S.value)==null||s.validate(o=>{o?(w.value=!0,le(I.protocolUrl+"/api/upload/file",l.uploadForm).then(p=>{p.code===200?(_({message:p.msg,type:"success"}),l.uploadForm={file:"",projectId:void 0,pathId:void 0,subPath:"",otherInfo:""},i.value=[]):_({message:p.msg,type:"warning"}),p.msg,w.value=!1}).catch(p=>{_({message:p.msg}),p.msg})):l.uploadForm.file||_({message:"您未上传文件",type:"warning"})})}function J(){P(I.protocolUrl+"/api/project/get",{}).then(s=>{s.code===200&&(l.projectList=s.data)})}function O(s){P(I.protocolUrl+"/api/project/path",{id:s}).then(o=>{o.code===200&&(l.projectPathList=o.data)}),v(l.uploadForm.projectId,l.uploadForm.pathId)}function Q(s){for(let o=0;o<l.projectPathList.length;o++)s===l.projectPathList[o].ID&&(l.projectPathList[o].hasSubPath==1?y.value=!0:y.value=!1);v(l.uploadForm.projectId,l.uploadForm.pathId)}function v(s,o){g.value=!0,P(I.protocolUrl+"/api/history/get",{remotePath:"",fileName:"",pathId:Number(o),projectId:Number(s)}).then(p=>{p.code===200&&(E.table=p.data.length>10?p.data.splice(0,10):p.data),g.value=!1}).catch(p=>{_({message:p.msg}),g.value=!1})}function W(s){return["上传中","部分成功","全部成功","失败"][s-1]}function X(){v(l.uploadForm.projectId,l.uploadForm.pathId)}function Y(){H.push("/historyList")}return(s,o)=>{const p=se,k=pe,c=re,d=ne,u=de,x=ue,G=T("upload-filled"),C=ie,K=ce,L=me,Z=_e,$=T("Refresh"),F=fe,ee=he,D=be;return n(),U("div",we,[Le,r("div",Pe,[r("div",Ue,[e(Z,{ref_key:"uploadFormRef",ref:S,model:l.uploadForm,rules:l.uploadFormRules,"label-position":"right","label-width":"120px",size:"large"},{default:t(()=>[e(u,null,{default:t(()=>[e(d,{span:24},{default:t(()=>[e(c,{prop:"projectId",label:"选择项目",class:"path-input"},{default:t(()=>[e(k,{modelValue:l.uploadForm.projectId,"onUpdate:modelValue":o[0]||(o[0]=a=>l.uploadForm.projectId=a),class:"m-2 w100",placeholder:"请选择项目",clearable:"",onChange:O},{default:t(()=>[(n(!0),U(B,null,q(l.projectList,a=>(n(),h(p,{key:a.ID,label:a.projectName,value:a.ID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(d,{span:24},{default:t(()=>[e(c,{prop:"pathId",label:"文件上传路径",class:"path-input"},{default:t(()=>[e(k,{modelValue:l.uploadForm.pathId,"onUpdate:modelValue":o[1]||(o[1]=a=>l.uploadForm.pathId=a),class:"m-2 w100",placeholder:"请选择文件上传路径",clearable:"",onChange:Q},{default:t(()=>[(n(!0),U(B,null,q(l.projectPathList,a=>(n(),h(p,{key:a.path,label:a.pathName+":"+a.path,value:a.ID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),f(y)?(n(),h(u,{key:0},{default:t(()=>[e(d,{span:24},{default:t(()=>[e(c,{prop:"subPath",label:"子路径",class:"path-input"},{default:t(()=>[e(x,{modelValue:l.uploadForm.subPath,"onUpdate:modelValue":o[2]||(o[2]=a=>l.uploadForm.subPath=a),placeholder:"您选择的路径包含子路径，请填写子路径"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):ge("",!0),e(u,null,{default:t(()=>[e(d,{span:24},{default:t(()=>[e(c,{prop:"otherInfo",label:"上传说明",class:"path-input"},{default:t(()=>[e(x,{modelValue:l.uploadForm.otherInfo,"onUpdate:modelValue":o[3]||(o[3]=a=>l.uploadForm.otherInfo=a),autocomplete:"off",rows:3,type:"textarea",resize:"none",placeholder:"上传说明"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(d,{span:24},{default:t(()=>[e(c,{prop:"file",label:"文件",required:""},{default:t(()=>[e(K,{class:"upload-demo",drag:"",limit:1,"http-request":M,"file-list":f(i),"onUpdate:file-list":o[4]||(o[4]=a=>Ie(i)?i.value=a:i=a)},{default:t(()=>[e(C,{class:"el-icon--upload"},{default:t(()=>[e(G)]),_:1}),Ve]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1}),e(u,null,{default:t(()=>[e(d,{span:6},{default:t(()=>[R((n(),h(L,{type:"primary",class:"upload-btn",onClick:A},{default:t(()=>[j("点击上传")]),_:1})),[[D,f(w),void 0,{fullscreen:!0,lock:!0}]])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),r("div",Ee,[r("div",Se,[ke,r("div",xe,[e(L,{type:"primary",size:"small",onClick:X},{default:t(()=>[e(C,null,{default:t(()=>[e($)]),_:1})]),_:1}),e(L,{type:"primary",size:"small",onClick:Y},{default:t(()=>[j("更多历史记录")]),_:1})])]),R((n(),h(ee,{data:f(E).table,style:{width:"100%"},border:"",stripe:""},{default:t(()=>[e(F,{prop:"ID",label:"历史ID",align:"center"}),e(F,{prop:"fileName",label:"文件名称",align:"center"}),e(F,{prop:"UserInfo",label:"操作用户",align:"center"},{default:t(a=>[r("span",null,z(a.row.UserInfo.name),1)]),_:1}),e(F,{prop:"updateStatus",label:"上传状态",align:"center"},{default:t(a=>[r("span",null,z(W(a.row.updateStatus)),1)]),_:1})]),_:1},8,["data"])),[[D,f(g)]])])])])}}});const Je=ye(Ce,[["__scopeId","data-v-db33bb1d"]]);export{Je as default};
