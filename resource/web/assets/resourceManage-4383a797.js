import{u as Z,p as D}from"./user-86fc3259.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                    *//* empty css                     *//* empty css                         *//* empty css                *//* empty css               *//* empty css                 */import{d as ee,a as M,r as y,P as te,j as m,f as oe,E as ae,S as le,T as re,V as ne,e as se,D as ie,F as ce,G as de,W as pe,b as me,c as ue,a2 as fe,X as _e,g as ge,h as b,A as r,m as f,w as e,p as _,i as o,L as je,Y as ve,o as u,a0 as g,B as i,z as he,$ as we,u as De,a1 as T,t as ye}from"./index-83698f75.js";const be={class:"main-wrap history-wrap"},ke={class:"wrap-title flex-space"},Ie=b("p",null,"项目管理",-1),Ne={class:"search-area"},Ce={class:"dialog-footer"},Se=ee({__name:"resourceManage",setup(Fe){const A=De();let C=M({table:[],serverList:[]});const F=y();let c=y(!1),k=y(!1),V=y("新增项目"),I=y(!1),n=M({dialogForm:{projectName:"",projectIntro:"",id:void 0},dialogFormRules:{projectName:[{required:!0,trigger:"blur",message:"请填写项目名称!"}],serverIdList:[{required:!0,trigger:"blur",message:"请选择绑定的服务器!"}]},searchData:{id:void 0,projectName:""}});const j=Z();te(()=>{L(),v()});function B(){c.value=!0,I.value=!0,V.value="新增项目",P()}function L(){D(j.protocolUrl+"/api/server/list",{}).then(t=>{t.code===200&&(C.serverList=t.data)})}function R(){var s;let t=I.value?"/api/project/add":"/api/project/edit",a=I.value?"新增成功！":"修改成功！";(s=F.value)==null||s.validate(d=>{d&&D(j.protocolUrl+t,n.dialogForm).then(p=>{p.code===200?(m({message:a,type:"success"}),c.value=!1,v()):m({message:p.msg})}).catch(p=>{m({message:p})})})}function v(){k.value=!0,D(j.protocolUrl+"/api/project/list",{id:Number(n.searchData.id),projectName:n.searchData.projectName}).then(t=>{t.code===200?C.table=t.data:m({message:t.msg}),k.value=!1}).catch(t=>{m({message:t.msg}),k.value=!1})}function S(t){V.value="修改项目",I.value=!1,c.value=!0,n.dialogForm={projectName:t.projectName,projectIntro:t.projectIntro,id:t.ID}}function P(){var t;n.dialogForm={projectName:"",projectIntro:"",id:void 0},(t=F.value)==null||t.clearValidate()}function z(){c.value=!1,P()}function Y(t){D(j.protocolUrl+"/api/project/delCheck",{id:t}).then(a=>{a.code===200?a.data=="true"||a.data==!0?T.confirm("该项目下存在关联路径，关联服务器以及关联用户，是否强制删除？若强制删除则该项目下的信息无法恢复！","提示",{confirmButtonText:"强制删除",cancelButtonText:"取消",type:"warning"}).then(()=>{x(t)}).catch(()=>{}):T.confirm("该项目删除后的信息无法恢复，是否删除？","提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{x(t)}).catch(()=>{}):m({message:a.msg})})}function x(t){D(j.protocolUrl+"/api/project/del",{id:t}).then(a=>{a.code===200?(m({message:"删除成功",type:"success"}),v()):m({message:a.msg})})}function $(){n.searchData={id:void 0,projectName:""},v()}function E(t,a,s){let d=s===1?"/projectUserManage":s===2?"/projectPathManage":"/projectServerManage";A.push({path:d,query:{projectId:t,projectName:a}})}return(t,a)=>{const s=oe,d=ae,p=le,q=re,h=ne,H=ye("arrow-down"),G=se,w=ie,W=ce,X=de,J=pe,U=me,K=ue,O=fe,Q=_e;return u(),ge("div",be,[b("div",ke,[Ie,r(g).ApiProjectAddPerm?(u(),f(s,{key:0,type:"primary",onClick:B},{default:e(()=>[i("新增")]),_:1})):_("",!0)]),b("div",Ne,[o(q,{gutter:20,type:"flex",justify:"end"},{default:e(()=>[o(p,{span:5},{default:e(()=>[o(d,{modelValue:r(n).searchData.id,"onUpdate:modelValue":a[0]||(a[0]=l=>r(n).searchData.id=l),modelModifiers:{number:!0},placeholder:"项目ID",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),o(p,{span:5},{default:e(()=>[o(d,{modelValue:r(n).searchData.projectName,"onUpdate:modelValue":a[1]||(a[1]=l=>r(n).searchData.projectName=l),placeholder:"项目名称",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),o(p,{span:4,class:"flex-end"},{default:e(()=>[o(s,{type:"primary",onClick:v},{default:e(()=>[i("搜索")]),_:1}),o(s,{onClick:$,type:"primary",plain:""},{default:e(()=>[i("重置")]),_:1})]),_:1})]),_:1})]),je((u(),f(J,{data:r(C).table,style:{width:"100%"},border:""},{default:e(()=>[o(h,{prop:"ID",label:"项目ID",align:"center"}),o(h,{prop:"projectName",label:"项目名称",align:"center"}),o(h,{prop:"projectIntro",label:"项目简介",align:"center"}),o(h,{prop:"serverIdList",label:"更新时间",align:"center"},{default:e(l=>[b("span",null,he(r(we)(l.row.UpdatedAt,"YYYY-MM-DD HH:mm:ss").value),1)]),_:1}),o(h,{label:"操作",align:"center"},{default:e(l=>[o(X,null,{dropdown:e(()=>[o(W,null,{default:e(()=>[r(g).ApiProjectEditPerm?(u(),f(w,{key:0,onClick:N=>S(l.row)},{default:e(()=>[i("修改项目")]),_:2},1032,["onClick"])):_("",!0),r(g).ApiProjectUserListPerm?(u(),f(w,{key:1,onClick:N=>E(l.row.ID,l.row.projectName,1)},{default:e(()=>[i("用户绑定")]),_:2},1032,["onClick"])):_("",!0),r(g).ApiProjectServerListPerm?(u(),f(w,{key:2,onClick:N=>E(l.row.ID,l.row.projectName,3)},{default:e(()=>[i("服务器绑定")]),_:2},1032,["onClick"])):_("",!0),r(g).ApiProjectPathPerm?(u(),f(w,{key:3,onClick:N=>E(l.row.ID,l.row.projectName,2)},{default:e(()=>[i("路径管理")]),_:2},1032,["onClick"])):_("",!0),r(g).ApiProjectDelPerm?(u(),f(w,{key:4,divided:"",onClick:N=>Y(l.row.ID)},{default:e(()=>[i("删除项目")]),_:2},1032,["onClick"])):_("",!0)]),_:2},1024)]),default:e(()=>[o(s,{type:"primary"},{default:e(()=>[i(" 详情管理 "),o(G,{class:"el-icon--right"},{default:e(()=>[o(H)]),_:1})]),_:1})]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Q,r(k)]]),o(O,{modelValue:r(c),"onUpdate:modelValue":a[4]||(a[4]=l=>ve(c)?c.value=l:c=l),title:r(V),width:"50%"},{footer:e(()=>[b("span",Ce,[o(s,{onClick:z},{default:e(()=>[i("取消")]),_:1}),o(s,{type:"primary",onClick:R},{default:e(()=>[i(" 确定 ")]),_:1})])]),default:e(()=>[o(K,{model:r(n).dialogForm,ref_key:"dialogFormRef",ref:F,"label-position":"right","label-width":"150px",size:"large",rules:r(n).dialogFormRules},{default:e(()=>[o(U,{label:"项目名称",prop:"projectName"},{default:e(()=>[o(d,{modelValue:r(n).dialogForm.projectName,"onUpdate:modelValue":a[2]||(a[2]=l=>r(n).dialogForm.projectName=l),autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(U,{label:"项目简介",prop:"projectIntro"},{default:e(()=>[o(d,{modelValue:r(n).dialogForm.projectIntro,"onUpdate:modelValue":a[3]||(a[3]=l=>r(n).dialogForm.projectIntro=l),autocomplete:"off",rows:3,type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Se as default};
