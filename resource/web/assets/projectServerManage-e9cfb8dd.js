import{u as x,p}from"./user-17fe6185.js";/* empty css                          *//* empty css                    */import{d as U,H as B,u as D,a as E,r as b,P as M,a3 as w,a4 as P,f as A,g as k,h as v,A as _,B as o,i as m,w as l,m as S,p as q,j as R,o as c,C as u,J as T,K as F,a0 as G}from"./index-a45fb3eb.js";const H={class:"main-wrap project-user-wrap"},J={class:"wrap-title"},K={class:"bottom-btn flex-end"},X=U({__name:"projectServerManage",setup($){const d=B(),h=D(),i=x();let e=E({table:[],checkedServer:[],serverIdList:[],tempServerList:[]});const s=b(!1),n=b(!0);M(()=>{I(),C()});function I(){p(i.protocolUrl+"/api/server/list",{}).then(r=>{r.code===200&&(e.table=r.data)})}function C(){p(i.protocolUrl+"/api/project/server/list",{id:Number(d.query.projectId)}).then(r=>{if(r.code===200&&r.data.length>0){for(let t=0;t<r.data.length;t++)e.tempServerList.push(r.data[t].serverName),e.serverIdList.push(r.data[t].ID);e.checkedServer=e.serverIdList,e.checkedServer.length==e.table.length?(n.value=!1,s.value=!0):s.value=!1}})}const L=r=>{if(e.table.length>0&&r==!0){e.serverIdList=[];for(let t=0;t<e.table.length;t++)e.tempServerList.push(e.table[t].serverName),e.serverIdList.push(e.table[t].ID)}else e.serverIdList=[];e.checkedServer=e.serverIdList,n.value=!1},j=r=>{const t=r.length;s.value=t===e.table.length,n.value=t>0&&t<e.table.length};function y(){p(i.protocolUrl+"/api/project/server/edit",{projectId:Number(d.query.projectId),serverIdList:e.checkedServer}).then(r=>{r.code==200&&(R({message:"绑定成功",type:"success"}),h.push("/resourceManage"))})}function N(){h.push("/resourceManage")}return(r,t)=>{const f=w,V=P,g=A;return c(),k("div",H,[v("div",J,[v("p",null,_(o(d).query.projectName)+"-服务器绑定管理",1)]),m(f,{modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=a=>s.value=a),indeterminate:n.value,onChange:t[1]||(t[1]=a=>L(s.value))},{default:l(()=>[u(" 全部服务器 ")]),_:1},8,["modelValue","indeterminate"]),m(V,{modelValue:o(e).checkedServer,"onUpdate:modelValue":t[2]||(t[2]=a=>o(e).checkedServer=a),onChange:j},{default:l(()=>[(c(!0),k(T,null,F(o(e).table,a=>(c(),S(f,{key:a.ID,label:a.ID},{default:l(()=>[u(_(a.serverName),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),v("div",K,[m(g,{type:"primary",onClick:N,class:"mt35"},{default:l(()=>[u(" 返回 ")]),_:1}),o(G).ApiProjectServerEditPerm?(c(),S(g,{key:0,type:"primary",onClick:y,class:"mt35"},{default:l(()=>[u(" 确定修改 ")]),_:1})):q("",!0)])])}}});export{X as default};
