import{u as Z,p as D}from"./user-17fe6185.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                    *//* empty css                     *//* empty css                         *//* empty css                *//* empty css               *//* empty css                 */import{d as ee,u as te,a as x,r as y,P as oe,j as f,f as ae,E as le,S as re,T as ne,V as se,e as ie,D as ce,F as de,G as pe,W as me,b as ue,c as fe,a2 as _e,X as ge,g as je,h as P,B as o,m as _,w as e,p as g,i as a,L as ve,Y as he,o as d,a0 as i,C as c,A as we,$ as De,a1 as M,t as ye}from"./index-a45fb3eb.js";const Pe={class:"main-wrap history-wrap"},be={class:"wrap-title flex-space"},ke=P("p",null,"项目管理",-1),Ie={class:"search-area"},Ce={class:"dialog-footer"},Se=ee({__name:"resourceManage",setup(Ne){const L=te();let C=x({table:[],serverList:[]});const N=y();let p=y(!1),b=y(!1),F=y("新增项目"),k=y(!1),n=x({dialogForm:{projectName:"",projectIntro:"",id:void 0},dialogFormRules:{projectName:[{required:!0,trigger:"blur",message:"请填写项目名称!"}],serverIdList:[{required:!0,trigger:"blur",message:"请选择绑定的服务器!"}]},searchData:{id:void 0,projectName:""}});const j=Z();oe(()=>{B(),v()});function T(){p.value=!0,k.value=!0,F.value="新增项目",E()}function B(){D(j.protocolUrl+"/api/server/list",{}).then(t=>{t.code===200&&(C.serverList=t.data)})}function R(){var s;let t=k.value?"/api/project/add":"/api/project/edit",l=k.value?"新增成功！":"修改成功！";(s=N.value)==null||s.validate(m=>{m&&D(j.protocolUrl+t,n.dialogForm).then(u=>{u.code===200?(f({message:l,type:"success"}),p.value=!1,v()):f({message:u.msg})}).catch(u=>{f({message:u})})})}function v(){b.value=!0,D(j.protocolUrl+"/api/project/list",{id:Number(n.searchData.id),projectName:n.searchData.projectName}).then(t=>{t.code===200?C.table=t.data:f({message:t.msg}),b.value=!1}).catch(t=>{f({message:t.msg}),b.value=!1})}function S(t){F.value="修改项目",k.value=!1,p.value=!0,n.dialogForm={projectName:t.projectName,projectIntro:t.projectIntro,id:t.ID}}function E(){var t;n.dialogForm={projectName:"",projectIntro:"",id:void 0},(t=N.value)==null||t.clearValidate()}function Y(){p.value=!1,E()}function $(t){D(j.protocolUrl+"/api/project/delCheck",{id:t}).then(l=>{l.code===200?l.data=="false"||l.data==!1?M.confirm("该项目下存在关联路径，关联服务器以及关联用户，是否强制删除？若强制删除则该项目下的信息无法恢复！","提示",{confirmButtonText:"强制删除",cancelButtonText:"取消",type:"warning"}).then(()=>{A(t)}).catch(()=>{}):M.confirm("该项目删除后的信息无法恢复，是否删除？","提示",{confirmButtonText:"删除",cancelButtonText:"取消",type:"warning"}).then(()=>{A(t)}).catch(()=>{}):f({message:l.msg})})}function A(t){D(j.protocolUrl+"/api/project/del",{id:t}).then(l=>{l.code===200?(f({message:"删除成功",type:"success"}),v()):f({message:l.msg})})}function z(){n.searchData={id:void 0,projectName:""},v()}function V(t,l,s){let m=s===1?"/projectUserManage":s===2?"/projectPathManage":"/projectServerManage";L.push({path:m,query:{projectId:t,projectName:l}})}return(t,l)=>{const s=ae,m=le,u=re,q=ne,h=se,H=ye("arrow-down"),G=ie,w=ce,W=de,X=pe,J=me,U=ue,K=fe,O=_e,Q=ge;return d(),je("div",Pe,[P("div",be,[ke,o(i).ApiProjectAddPerm?(d(),_(s,{key:0,type:"primary",onClick:T},{default:e(()=>[c("新增")]),_:1})):g("",!0)]),P("div",Ie,[a(q,{gutter:20,type:"flex",justify:"end"},{default:e(()=>[a(u,{span:5},{default:e(()=>[a(m,{modelValue:o(n).searchData.id,"onUpdate:modelValue":l[0]||(l[0]=r=>o(n).searchData.id=r),modelModifiers:{number:!0},placeholder:"项目ID",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),a(u,{span:5},{default:e(()=>[a(m,{modelValue:o(n).searchData.projectName,"onUpdate:modelValue":l[1]||(l[1]=r=>o(n).searchData.projectName=r),placeholder:"项目名称",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),a(u,{span:4,class:"flex-end"},{default:e(()=>[a(s,{type:"primary",onClick:v},{default:e(()=>[c("搜索")]),_:1}),a(s,{onClick:z,type:"primary",plain:""},{default:e(()=>[c("重置")]),_:1})]),_:1})]),_:1})]),ve((d(),_(J,{data:o(C).table,style:{width:"100%"},border:""},{default:e(()=>[a(h,{prop:"ID",label:"项目ID",align:"center"}),a(h,{prop:"projectName",label:"项目名称",align:"center"}),a(h,{prop:"projectIntro",label:"项目简介",align:"center"}),a(h,{prop:"serverIdList",label:"更新时间",align:"center"},{default:e(r=>[P("span",null,we(o(De)(r.row.UpdatedAt,"YYYY-MM-DD HH:mm:ss").value),1)]),_:1}),a(h,{label:"操作",align:"center"},{default:e(r=>[a(X,null,{dropdown:e(()=>[a(W,null,{default:e(()=>[o(i).ApiProjectEditPerm?(d(),_(w,{key:0,onClick:I=>S(r.row)},{default:e(()=>[c("修改项目")]),_:2},1032,["onClick"])):g("",!0),o(i).ApiProjectUserListPerm?(d(),_(w,{key:1,onClick:I=>V(r.row.ID,r.row.projectName,1)},{default:e(()=>[c("用户绑定")]),_:2},1032,["onClick"])):g("",!0),o(i).ApiProjectServerListPerm?(d(),_(w,{key:2,onClick:I=>V(r.row.ID,r.row.projectName,3)},{default:e(()=>[c("服务器绑定")]),_:2},1032,["onClick"])):g("",!0),o(i).ApiProjectPathPerm?(d(),_(w,{key:3,onClick:I=>V(r.row.ID,r.row.projectName,2)},{default:e(()=>[c("路径管理")]),_:2},1032,["onClick"])):g("",!0),o(i).ApiProjectDelPerm?(d(),_(w,{key:4,divided:"",onClick:I=>$(r.row.ID)},{default:e(()=>[c("删除项目")]),_:2},1032,["onClick"])):g("",!0)]),_:2},1024)]),default:e(()=>[o(i).ApiProjectEditPerm||o(i).ApiProjectUserListPerm||o(i).ApiProjectServerListPerm||o(i).ApiProjectPathPerm||o(i).ApiProjectDelPerm?(d(),_(s,{key:0,type:"primary"},{default:e(()=>[c(" 详情管理 "),a(G,{class:"el-icon--right"},{default:e(()=>[a(H)]),_:1})]),_:1})):g("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[Q,o(b)]]),a(O,{modelValue:o(p),"onUpdate:modelValue":l[4]||(l[4]=r=>he(p)?p.value=r:p=r),title:o(F),width:"50%"},{footer:e(()=>[P("span",Ce,[a(s,{onClick:Y},{default:e(()=>[c("取消")]),_:1}),a(s,{type:"primary",onClick:R},{default:e(()=>[c(" 确定 ")]),_:1})])]),default:e(()=>[a(K,{model:o(n).dialogForm,ref_key:"dialogFormRef",ref:N,"label-position":"right","label-width":"150px",size:"large",rules:o(n).dialogFormRules},{default:e(()=>[a(U,{label:"项目名称",prop:"projectName"},{default:e(()=>[a(m,{modelValue:o(n).dialogForm.projectName,"onUpdate:modelValue":l[2]||(l[2]=r=>o(n).dialogForm.projectName=r),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(U,{label:"项目简介",prop:"projectIntro"},{default:e(()=>[a(m,{modelValue:o(n).dialogForm.projectIntro,"onUpdate:modelValue":l[3]||(l[3]=r=>o(n).dialogForm.projectIntro=r),autocomplete:"off",rows:3,type:"textarea",resize:"none"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{Se as default};
