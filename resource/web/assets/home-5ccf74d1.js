import{u as te,p as L,a as le}from"./user-4e4394e2.js";/* empty css                        *//* empty css                    *//* empty css                     *//* empty css                     *//* empty css                *//* empty css                 *//* empty css               *//* empty css                  */import{d as ae,a as D,r as i,O as oe,j as P,P as se,Q as pe,b as re,R as ne,S as ue,E as de,e as ce,T as ie,f as me,c as _e,U as fe,V as he,W as be,g as w,h as r,i as e,w as t,K as N,z as m,k as _,o as n,H as R,I as B,m as ge,X as ve,A as U,y as H,p as Ie,q as Fe,u as je,s as T,_ as ye}from"./index-6873b35d.js";const E=f=>(Ie("data-v-ce4bacb9"),f=f(),Fe(),f),Le={class:"main-wrap home-wrap"},Pe=E(()=>r("div",{class:"wrap-title"},[r("p",null,"文件上传")],-1)),we={class:"upload-form flex-space"},Ue={class:"left-form w50"},Ee=E(()=>r("div",{class:"el-upload__text"},[U(" Drop file here or "),r("em",null,"click to upload")],-1)),Se={class:"right-upload-info w50"},Ve={class:"line-head flex-space"},ke=E(()=>r("p",null,"历史记录",-1)),Ce={class:"rl-btn"},xe=ae({__name:"home",setup(f){let S=D({table:[]});const q=je();let h=i(!1);const b=te(),V=i();let F=i(!1),j=i(!1);const l=D({uploadForm:{file:"",projectId:void 0,pathId:void 0,subPath:""},uploadFormRules:{projectId:[{required:!0,trigger:"blur",message:"请选择项目!"}],pathId:[{required:!0,trigger:"blur",message:"请选择文件上传路径！"}]},projectList:[],projectPathList:[]});let u=i([]);oe(()=>{O(),g()});const z=s=>(s.file&&(l.uploadForm.file=s.file),s.file);function M(){var s;(s=V.value)==null||s.validate(a=>{a&&(j.value=!0,le(b.protocolUrl+"/api/upload/file",l.uploadForm).then(p=>{p.code===200&&(P({message:p.msg,type:"success"}),l.uploadForm={file:"",projectId:void 0,pathId:void 0,subPath:""},u.value=[]),p.msg,j.value=!1}).catch(p=>{P({message:p.msg}),p.msg}))})}function O(){L(b.protocolUrl+"/api/project/get",{}).then(s=>{s.code===200&&(l.projectList=s.data)})}function A(s){L(b.protocolUrl+"/api/project/path",{id:s}).then(a=>{a.code===200&&(l.projectPathList=a.data)}),g(l.uploadForm.projectId,l.uploadForm.pathId)}function K(s){for(let a=0;a<l.projectPathList.length;a++)s===l.projectPathList[a].ID&&(l.projectPathList[a].hasSubPath==1?F.value=!0:F.value=!1);g(l.uploadForm.projectId,l.uploadForm.pathId)}function g(s,a){h.value=!0,L(b.protocolUrl+"/api/history/get",{remotePath:"",fileName:"",pathId:Number(a),projectId:Number(s)}).then(p=>{p.code===200&&(S.table=p.data.length>8?p.data.splice(0,8):p.data),h.value=!1}).catch(p=>{P({message:p.msg}),h.value=!1})}function Q(s){return["上传中","部分成功","全部成功","失败"][s-1]}function W(){g(l.uploadForm.projectId,l.uploadForm.pathId)}function X(){q.push("/historyList")}return(s,a)=>{const p=se,k=pe,v=re,d=ne,c=ue,G=de,J=T("upload-filled"),C=ce,Y=ie,y=me,Z=_e,$=T("Refresh"),I=fe,ee=he,x=be;return n(),w("div",Le,[Pe,r("div",we,[r("div",Ue,[e(Z,{ref_key:"uploadFormRef",ref:V,model:l.uploadForm,rules:l.uploadFormRules,"label-position":"right","label-width":"120px",size:"large"},{default:t(()=>[e(c,null,{default:t(()=>[e(d,{span:24},{default:t(()=>[e(v,{prop:"projectId",label:"选择项目",class:"path-input"},{default:t(()=>[e(k,{modelValue:l.uploadForm.projectId,"onUpdate:modelValue":a[0]||(a[0]=o=>l.uploadForm.projectId=o),class:"m-2 w100",placeholder:"请选择项目",clearable:"",onChange:A},{default:t(()=>[(n(!0),w(R,null,B(l.projectList,o=>(n(),_(p,{key:o.ID,label:o.projectName,value:o.ID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(d,{span:24},{default:t(()=>[e(v,{prop:"pathId",label:"文件上传路径",class:"path-input"},{default:t(()=>[e(k,{modelValue:l.uploadForm.pathId,"onUpdate:modelValue":a[1]||(a[1]=o=>l.uploadForm.pathId=o),class:"m-2 w100",placeholder:"请选择文件上传路径",clearable:"",onChange:K},{default:t(()=>[(n(!0),w(R,null,B(l.projectPathList,o=>(n(),_(p,{key:o.path,label:o.pathName+":"+o.path,value:o.ID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),m(F)?(n(),_(c,{key:0},{default:t(()=>[e(d,{span:24},{default:t(()=>[e(v,{prop:"subPath",label:"子路径",class:"path-input"},{default:t(()=>[e(G,{modelValue:l.uploadForm.subPath,"onUpdate:modelValue":a[2]||(a[2]=o=>l.uploadForm.subPath=o),placeholder:"您选择的路径包含子路径，请填写子路径"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})):ge("",!0),e(c,null,{default:t(()=>[e(d,{span:24},{default:t(()=>[e(v,{prop:"file",label:"文件"},{default:t(()=>[e(Y,{class:"upload-demo",drag:"",limit:1,"http-request":z,"file-list":m(u),"onUpdate:file-list":a[3]||(a[3]=o=>ve(u)?u.value=o:u=o)},{default:t(()=>[e(C,{class:"el-icon--upload"},{default:t(()=>[e(J)]),_:1}),Ee]),_:1},8,["file-list"])]),_:1})]),_:1})]),_:1}),e(c,null,{default:t(()=>[e(d,{span:6},{default:t(()=>[N((n(),_(y,{type:"primary",class:"upload-btn",onClick:M},{default:t(()=>[U("点击上传")]),_:1})),[[x,m(j),void 0,{fullscreen:!0,lock:!0}]])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),r("div",Se,[r("div",Ve,[ke,r("div",Ce,[e(y,{type:"primary",size:"small",onClick:W},{default:t(()=>[e(C,null,{default:t(()=>[e($)]),_:1})]),_:1}),e(y,{type:"primary",size:"small",onClick:X},{default:t(()=>[U("更多历史记录")]),_:1})])]),N((n(),_(ee,{data:m(S).table,style:{width:"100%"},border:"",stripe:""},{default:t(()=>[e(I,{prop:"ID",label:"历史ID",align:"center"}),e(I,{prop:"fileName",label:"文件名称",align:"center"}),e(I,{prop:"UserInfo",label:"操作用户",align:"center"},{default:t(o=>[r("span",null,H(o.row.UserInfo.name),1)]),_:1}),e(I,{prop:"updateStatus",label:"上传状态",align:"center"},{default:t(o=>[r("span",null,H(Q(o.row.updateStatus)),1)]),_:1})]),_:1},8,["data"])),[[x,m(h)]])])])])}}});const Ae=ye(xe,[["__scopeId","data-v-ce4bacb9"]]);export{Ae as default};
