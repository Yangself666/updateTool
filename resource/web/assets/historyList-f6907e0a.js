import{u as J,p as I}from"./user-86fc3259.js";/* empty css                        *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                  */import{d as O,a as Q,r as m,P as W,j as U,Q as X,R as Z,S as q,E as G,f as K,T as $,V as ee,Z as te,W as ae,X as le,g as h,h as s,i as t,w as a,L as B,A as n,m as V,o as i,Y as k,I as C,J as N,B as D,z as d,$ as x,a0 as oe,p as re,a1 as ne}from"./index-83698f75.js";const se={class:"main-wrap history-wrap"},pe=s("div",{class:"wrap-title"},[s("p",null,"历史记录")],-1),ie={class:"search-area"},ue=s("span",{class:"hover-popver"},"详情查看",-1),ce={class:"hover-popver"},ye=O({__name:"historyList",setup(de){let f=Q({table:[],projectList:[]}),u=m(""),c=m(""),p=m(),b=m(!1),_=m(!1);const w=J();W(()=>{v(),M()});function v(){_.value=!0,I(w.protocolUrl+"/api/history/get",{remotePath:u.value,fileName:c.value,projectId:p.value?Number(p.value):void 0}).then(l=>{l.code===200&&(f.table=l.data),_.value=!1}).catch(l=>{U({message:l.msg}),_.value=!1})}function Y(l){ne.confirm("确认回滚此版本数据吗?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{b.value=!0,I(w.protocolUrl+"/api/history/rollback",{id:l}).then(o=>{o.code===200?U({message:o.data,type:"success"}):U({message:"回滚失败，请稍后再试",type:"warning"}),b.value=!1})}).catch(()=>{})}function M(){I(w.protocolUrl+"/api/project/get",{}).then(l=>{l.code===200&&(f.projectList=l.data)})}function P(){u.value="",c.value="",p.value=void 0,v()}function T(l){if(l!==""&&l!==void 0&&l!==null){let o=JSON.parse(l);return o instanceof Array?o:[]}}function A(l){return["上传中","部分成功","全部成功","失败"][l-1]}return(l,o)=>{const H=X,z=Z,g=q,E=G,y=K,R=$,r=ee,L=te,F=ae,S=le;return i(),h("div",se,[pe,s("div",ie,[t(R,{gutter:20,type:"flex",justify:"end",class:"row-bg"},{default:a(()=>[t(g,{span:6,pull:2},{default:a(()=>[t(z,{modelValue:n(p),"onUpdate:modelValue":o[0]||(o[0]=e=>k(p)?p.value=e:p=e),class:"m-2 w100",placeholder:"请选择项目",clearable:"",size:"large",onChange:v},{default:a(()=>[(i(!0),h(C,null,N(n(f).projectList,e=>(i(),V(H,{key:e.ID,label:e.projectName,value:e.ID},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(g,{span:6},{default:a(()=>[t(E,{modelValue:n(u),"onUpdate:modelValue":o[1]||(o[1]=e=>k(u)?u.value=e:u=e),placeholder:"文件路径",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),t(g,{span:6},{default:a(()=>[t(E,{modelValue:n(c),"onUpdate:modelValue":o[2]||(o[2]=e=>k(c)?c.value=e:c=e),placeholder:"文件名称",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),t(g,{span:4,class:"flex-end"},{default:a(()=>[t(y,{type:"primary",onClick:v},{default:a(()=>[D("搜索")]),_:1}),t(y,{onClick:P,type:"primary",plain:""},{default:a(()=>[D("重置")]),_:1})]),_:1})]),_:1})]),B((i(),V(F,{data:n(f).table,style:{width:"100%"},border:"",stripe:""},{default:a(()=>[t(r,{prop:"ID",label:"历史ID",align:"center",width:"100"}),t(r,{prop:"UpdatedAt",label:"更新时间",align:"center"},{default:a(e=>[s("span",null,d(n(x)(e.row.UpdatedAt,"YYYY-MM-DD HH:mm:ss").value),1)]),_:1}),t(r,{prop:"remotePath",label:"远程路径",align:"center"}),t(r,{prop:"fileName",label:"文件名称",align:"center"}),t(r,{prop:"UserInfo",label:"操作用户",align:"center"},{default:a(e=>[s("span",null,d(e.row.UserInfo.name),1)]),_:1}),t(r,{prop:"updateStatus",label:"上传状态",align:"center"},{default:a(e=>[s("span",null,d(A(e.row.updateStatus)),1)]),_:1}),t(r,{prop:"serverInfo",label:"服务器情况",align:"center"},{default:a(e=>[t(L,{placement:"bottom-start",title:"服务器情况",width:300,trigger:"hover"},{reference:a(()=>[ue]),default:a(()=>[(i(!0),h(C,null,N(T(e.row.serverInfo),j=>(i(),h("p",null,d(j),1))),256))]),_:2},1024)]),_:1}),t(r,{prop:"otherInfo",label:"其他信息",align:"center"},{default:a(e=>[t(L,{placement:"bottom-start",title:"上传备注",width:200,trigger:"hover",content:e.row.otherInfo},{reference:a(()=>[s("span",ce,d(e.row.otherInfo?"上传备注":""),1)]),_:2},1032,["content"])]),_:1}),t(r,{prop:"UpdatedAt",label:"更新时间",align:"center"},{default:a(e=>[s("span",null,d(n(x)(e.row.UpdatedAt,"YYYY-MM-DD HH:mm:ss").value),1)]),_:1}),t(r,{label:"操作",align:"center"},{default:a(e=>[n(oe).ApiHistoryRollbackPerm?B((i(),V(y,{key:0,type:"primary",onClick:j=>Y(e.row.ID),size:"small"},{default:a(()=>[D("回滚到此版本")]),_:2},1032,["onClick"])),[[S,n(b),void 0,{fullscreen:!0,lock:!0}]]):re("",!0)]),_:1})]),_:1},8,["data"])),[[S,n(_)]])])}}});export{ye as default};
