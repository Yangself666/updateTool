import{u as X,p as w}from"./user-86fc3259.js";/* empty css                        *//* empty css                   *//* empty css                     *//* empty css                    *//* empty css                     *//* empty css               *//* empty css                 *//* empty css                  */import{d as G,a as P,r as V,P as Z,j as g,f as ee,E as le,S as ae,Q as oe,R as re,T as te,V as se,W as de,b as ie,c as ue,a2 as ne,X as me,g as E,h as y,A as l,m,w as t,p as _,i as a,L as pe,Y as ce,o as d,a0 as k,B as v,I as z,J as A,z as M,$ as ve,a1 as D}from"./index-83698f75.js";const fe={class:"main-wrap history-wrap"},ge={class:"wrap-title flex-space"},_e=y("p",null,"服务器管理",-1),ye={class:"search-area"},be={class:"dialog-footer"},xe=G({__name:"serverManage",setup(Ve){let N=P({table:[]});const U=V();let p=V(!1),h=V(!1),C=V("新增服务器"),F=V(!1),r=P({dialogForm:{serverName:"",serverType:void 0,host:"",port:void 0,username:"",password:"",privateKey:"",id:void 0},serverTypeList:[{value:1,label:"Password"},{value:2,label:"PrivateKey"}],dialogFormRules:{serverName:[{required:!0,trigger:"blur",message:"请填写服务器名称!"}],serverType:[{required:!0,trigger:"blur",message:"请选择服务器认证类型!"}],host:[{required:!0,trigger:"blur",message:"请填写服务器主机地址!"}],port:[{required:!0,trigger:"blur",message:"请填写服务器端口!"}]},searchData:{id:void 0,serverName:"",host:"",serverType:void 0}});const T=X();Z(()=>{b()});function L(){C.value="新增服务器",p.value=!0,F.value=!0,x()}function R(){var i;let s=F.value?"/api/server/add":"/api/server/edit",o=F.value?"新增成功！":"修改成功！";(i=U.value)==null||i.validate(u=>{u&&w(T.protocolUrl+s,r.dialogForm).then(n=>{n.code===200?(g({message:o,type:"success"}),p.value=!1,b()):g({message:n.msg})}).catch(n=>{g({message:n})})})}function K(s){C.value="修改服务器",F.value=!1,p.value=!0,r.dialogForm=s}function x(){var s;r.dialogForm={serverName:"",serverType:void 0,host:"",port:void 0,username:"",password:"",privateKey:"",id:void 0},(s=U.value)==null||s.clearValidate()}function Y(s){D.confirm("确认删除此数据吗?","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(()=>{w(T.protocolUrl+"/api/server/del",{id:s}).then(o=>{o.code===200?(g({message:"删除成功",type:"success"}),b()):g({message:o.msg})})}).catch(()=>{})}function b(){h.value=!0,w(T.protocolUrl+"/api/server/list",r.searchData).then(s=>{s.code===200&&(N.table=s.data),h.value=!1}).catch(s=>{g({message:s.msg}),h.value=!1})}function q(){r.searchData={id:void 0,serverName:"",host:"",serverType:void 0},b()}function $(){p.value=!1,x()}function j(s){w(T.protocolUrl+"/api/server/check",{id:Number(s)}).then(o=>{o.code==200?D.alert(o.msg,"服务器状况查看",{confirmButtonText:"确定"}):D.alert(o.msg,"服务器状况检查",{confirmButtonText:"确定"})}).catch(o=>{D.alert(o.msg,"服务器状况检查",{confirmButtonText:"确定"})})}return(s,o)=>{const i=ee,u=le,n=ae,B=oe,S=re,H=te,c=se,J=de,f=ie,O=ue,Q=ne,W=me;return d(),E("div",fe,[y("div",ge,[_e,l(k).ApiServerAddPerm?(d(),m(i,{key:0,type:"primary",onClick:L},{default:t(()=>[v("新增")]),_:1})):_("",!0)]),y("div",ye,[a(H,{gutter:20,type:"flex",justify:"end"},{default:t(()=>[a(n,{span:5},{default:t(()=>[a(u,{modelValue:l(r).searchData.id,"onUpdate:modelValue":o[0]||(o[0]=e=>l(r).searchData.id=e),modelModifiers:{number:!0},placeholder:"服务器ID",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{span:5},{default:t(()=>[a(u,{modelValue:l(r).searchData.serverName,"onUpdate:modelValue":o[1]||(o[1]=e=>l(r).searchData.serverName=e),placeholder:"服务器名称",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{span:5},{default:t(()=>[a(u,{modelValue:l(r).searchData.host,"onUpdate:modelValue":o[2]||(o[2]=e=>l(r).searchData.host=e),placeholder:"服务器主机地址",size:"large",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{span:5},{default:t(()=>[a(S,{modelValue:l(r).searchData.serverType,"onUpdate:modelValue":o[3]||(o[3]=e=>l(r).searchData.serverType=e),class:"m-2 w100",placeholder:"服务器验证类型",clearable:"",size:"large"},{default:t(()=>[(d(!0),E(z,null,A(l(r).serverTypeList,e=>(d(),m(B,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(n,{span:4,class:"flex-end"},{default:t(()=>[a(i,{type:"primary",onClick:b},{default:t(()=>[v("搜索")]),_:1}),a(i,{onClick:q,type:"primary",plain:""},{default:t(()=>[v("重置")]),_:1})]),_:1})]),_:1})]),pe((d(),m(J,{data:l(N).table,style:{width:"100%"},border:""},{default:t(()=>[a(c,{prop:"ID",label:"服务器ID",align:"center",width:"90px"}),a(c,{prop:"serverName",label:"服务器名称",align:"center"}),a(c,{prop:"serverType",label:"服务器认证类型",align:"center"},{default:t(e=>[y("span",null,M(e.row.serverType==1?"Password ":"PrivateKey"),1)]),_:1}),a(c,{prop:"host",label:"服务器主机地址",align:"center"}),a(c,{prop:"port",label:"服务器端口",align:"center"}),a(c,{prop:"username",label:"服务器登陆用户名",align:"center"}),a(c,{prop:"serverIdList",label:"更新时间",align:"center"},{default:t(e=>[y("span",null,M(l(ve)(e.row.UpdatedAt,"YYYY-MM-DD HH:mm:ss").value),1)]),_:1}),a(c,{label:"操作",align:"center",width:"220"},{default:t(e=>[l(k).ApiServerCheckPerm?(d(),m(i,{key:0,type:"primary",size:"small",onClick:I=>j(e.row.ID)},{default:t(()=>[v("检查状况")]),_:2},1032,["onClick"])):_("",!0),l(k).ApiServerEditPerm?(d(),m(i,{key:1,type:"primary",size:"small",onClick:I=>K(e.row)},{default:t(()=>[v("修改")]),_:2},1032,["onClick"])):_("",!0),l(k).ApiServerDelPerm?(d(),m(i,{key:2,type:"primary",size:"small",onClick:I=>Y(e.row.ID)},{default:t(()=>[v("删除")]),_:2},1032,["onClick"])):_("",!0)]),_:1})]),_:1},8,["data"])),[[W,l(h)]]),a(Q,{modelValue:l(p),"onUpdate:modelValue":o[11]||(o[11]=e=>ce(p)?p.value=e:p=e),title:l(C),width:"50%"},{footer:t(()=>[y("span",be,[a(i,{onClick:$},{default:t(()=>[v("取消")]),_:1}),a(i,{type:"primary",onClick:R},{default:t(()=>[v("确定")]),_:1})])]),default:t(()=>[a(O,{model:l(r).dialogForm,ref_key:"dialogFormRef",ref:U,"label-position":"right","label-width":"150px",size:"large",rules:l(r).dialogFormRules},{default:t(()=>[a(f,{label:"服务器名称",prop:"serverName"},{default:t(()=>[a(u,{modelValue:l(r).dialogForm.serverName,"onUpdate:modelValue":o[4]||(o[4]=e=>l(r).dialogForm.serverName=e),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(f,{label:"服务器认证类型",prop:"serverType"},{default:t(()=>[a(S,{modelValue:l(r).dialogForm.serverType,"onUpdate:modelValue":o[5]||(o[5]=e=>l(r).dialogForm.serverType=e),class:"m-2 w100",placeholder:"请选择服务器认证类型",clearable:""},{default:t(()=>[(d(!0),E(z,null,A(l(r).serverTypeList,e=>(d(),m(B,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(f,{label:"服务器主机地址",prop:"host"},{default:t(()=>[a(u,{modelValue:l(r).dialogForm.host,"onUpdate:modelValue":o[6]||(o[6]=e=>l(r).dialogForm.host=e),autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(f,{label:"服务器端口",prop:"port"},{default:t(()=>[a(u,{modelValue:l(r).dialogForm.port,"onUpdate:modelValue":o[7]||(o[7]=e=>l(r).dialogForm.port=e),modelModifiers:{number:!0},autocomplete:"off"},null,8,["modelValue"])]),_:1}),a(f,{label:"服务器登陆用户名",prop:"username"},{default:t(()=>[a(u,{modelValue:l(r).dialogForm.username,"onUpdate:modelValue":o[8]||(o[8]=e=>l(r).dialogForm.username=e),autocomplete:"off"},null,8,["modelValue"])]),_:1}),l(r).dialogForm.serverType===1?(d(),m(f,{key:0,label:"服务器登陆密码",prop:"password"},{default:t(()=>[a(u,{modelValue:l(r).dialogForm.password,"onUpdate:modelValue":o[9]||(o[9]=e=>l(r).dialogForm.password=e),autocomplete:"off"},null,8,["modelValue"])]),_:1})):_("",!0),l(r).dialogForm.serverType===2?(d(),m(f,{key:1,label:"服务器ssh secret",prop:"privateKey"},{default:t(()=>[a(u,{modelValue:l(r).dialogForm.privateKey,"onUpdate:modelValue":o[10]||(o[10]=e=>l(r).dialogForm.privateKey=e),autocomplete:"off"},null,8,["modelValue"])]),_:1})):_("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])])}}});export{xe as default};
